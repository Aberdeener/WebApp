{% extends "base.jinja2" %}

{% macro dialog_close_button(id) %}
    <button class="dialog-close-button icon-button" data-for="{{id}}">
        <div class="icon" style="background-image: url('/static/icon/close.svg')"></div>
    </button>
{% endmacro %}

{% macro dialog_header(id, title, back_id = None) %}
    <div class="flex-space-between">
        {% if back_id %}
            <span>
                {{ icon_button('arrow-left', back_id) }}
            </span>
        {% endif %}
        <span>
            <h3>{{ title }}</h3>
        </span>
        <span>
            {{ dialog_close_button(id) }}
        </span>
    </div>
{% endmacro %}

{% block title %}
    Super fancy music player 2.0
{% endblock title %}

{% block styles %}
    {% assets "css/player.scss", filters="pyscss,cssmin", output="gen/player.css" %}
        <link rel="stylesheet" href="{{ ASSET_URL }}">
    {% endassets %}
{% endblock styles %}

{% block content %}
    <div id="bg-image-1" class="bg-image bg-image-blurred"></div>
    <div id="bg-image-2" class="bg-image bg-image-blurred fade-image-top"></div>
    <div class="bg-image bg-image-blurred dither"></div>

    <div class="sidebar sidebar-left">

        <div>

            <div class="box-rounded box-solid">

                <h3>{% trans %}Playlists{% endtrans %}</h3>

                <div id="playlist-checkboxes">
                    {% trans %}Loading...{% endtrans %}
                </div>
            </div>

            <div class="box-rounded box-solid">

                <h3>{% trans %}Playback{% endtrans %}</h3>

                <p>
                    <span id="current-track">{% trans %}Waiting for music in queue...{% endtrans %}</span>
                </p>
                <p class="secondary">
                    {% trans %}Previously: {% endtrans %} <span id="previous-track">-</span>
                </p>

                <div class="outer-bar">
                    <div id="progress-bar"></div>
                    <div class="flex-space-between">
                        <span id="progress-time-current" class="progress-time">--:--</span>
                        <span id="progress-time-duration" class="progress-time">--:--</span>
                    </div>
                </div>

                {% for button_name in ['skip-previous', 'rewind-15', 'play', 'pause', 'fast-forward-15', 'skip-next', 'microphone', 'album'] %}
                    {{ icon_button(button_name, 'button-' + button_name) }}
                {% endfor %}

                {{ icon_button('gear', 'open-dialog-settings') }}
                {% if user_is_admin %}
                    {{ icon_button('pencil', 'button-edit') }}
                {% endif %}

                {% if mobile %}
                    {# 'data-restore=false' ensures volume is not overwritten from cookie #}
                    <input type="hidden" value="100" id="settings-volume" data-restore="false">
                {% else %}
                    <input type="range" min="0" max="100" value="50" id="settings-volume">
                {% endif %}
            </div>

            <div class="box-rounded box-solid box-queue">
                <div class="flex-space-between">
                    <h3>{% trans %}Queue{% endtrans %} (<span id="current-queue-size">0</span>)</h3>
                    <div>
                        {{ icon_button('tag-multiple', 'open-dialog-tags') }}
                        {{ icon_button('playlist-plus', 'browse-all') }}
                    </div>
                </div>
                <div class="scroll" id="queue-scroll">
                    <table id="queue-table"></table>
                </div>
                {# Was a fix for a mobile scroll issue, but it seems to be fixed... #}
                {# Instead of removing it, hide it for now until we're sure it can be removed #}
                <div class="queue-buttons flex-space-between hidden">
                    {{ icon_button('arrow-down', 'queue-down')}}
                    {{ icon_button('arrow-up', 'queue-up')}}
                </div>
            </div>

        </div>

    </div>

    <div class="sidebar sidebar-right" id="sidebar-album-covers">
        <div class="album-covers">
            <div id="album-cover-1" class="box-rounded"></div>
            <div id="album-cover-2" class="box-rounded fade-image-top"></div>
        </div>
    </div>

    <div class="sidebar sidebar-right" id="sidebar-lyrics">
        <div class="lyrics-outer box-rounded box-solid">
            <div id="lyrics"></div>
        </div>
    </div>

    <div id="dialog-settings" class="full-page-overlay hidden dialog-overlay">
        <div class="box-rounded box-solid">
            {{ dialog_header('dialog-settings', gettext('Settings')) }}
            <div class="scroll">
                <h4>{% trans %}Hotkeys{% endtrans %}</h4>
                <table class="hotkeys-table">
                    <tbody>
                        <tr>
                            <td><kbd>1</kbd> - <kbd>9</kbd></td>
                            <td>{% trans %}Toggle playlists{% endtrans %}</td>
                        </tr>
                        <tr>
                            <td><kbd>←</kbd></td>
                            <td>{% trans %}Previous track{% endtrans %}</td>
                        </tr>
                        <tr>
                            <td><kbd>→</kbd></td>
                            <td>{% trans %}Next track{% endtrans %}</td>
                        </tr>
                        <tr>
                            <td><kbd>&lt;</kbd> / <kbd>&gt;</kbd>
                            <td>{% trans %}Seek in track (don't use shift){% endtrans %}</td>
                        </tr>
                    </tbody>
                </table>

                <h4>{% trans %}Settings{% endtrans %}</h4>
                <div>
                    <input type="number" value="4" style="width: 3rem;" id="settings-queue-size">
                    <label for="settings-queue-size">{% trans %}Minimum queue length{% endtrans %}</label>
                </div>
                <div>
                    <select id="settings-audio-quality">
                        <option value="verylow">{% trans %}Potato (~15MB per hour, Safari ~30MB){% endtrans %}</option>
                        <option value="low">{% trans %}Low (~35MB per hour, Safari ~65MB){% endtrans %}</option>
                        <option value="high" selected>{% trans %}High (~60MB per hour, Safari ~110MB){% endtrans %}</option>
                    </select>
                    <label for="settings-audio-quality">{% trans %}Audio quality{% endtrans %}</label>
                </div>
                <div>
                    <select id="settings-queue-removal-behaviour">
                        <option value="same" selected>{% trans %}New track from same playlist{% endtrans %}</option>
                        <option value="roundrobin">{% trans %}New track from next round-robin playlist{% endtrans %}</option>
                    </select>
                    <label for="settings-queue-removal-behaviour">{% trans %}Queue removal behaviour{% endtrans %}</label>
                </div>
                <div>
                    <select id="settings-theme">
                        <option value="dark" selected>{% trans %}Dark{% endtrans%}</option>
                        <option value="light">{% trans %}Light{% endtrans%}</option>
                        <option value="browser">{% trans %}Use system preference{% endtrans%}</option>
                    </select>
                    <label for="settings-theme">{% trans %}Theme{% endtrans %}</label>
                </div>
                <div>
                    <input id="settings-meme-mode" type="checkbox">
                    <label for="settings-meme-mode">{% trans %}Album cover meme mode{% endtrans %}</label>
                </div>

                <h4>{% trans %}YouTube download{% endtrans %}</h4>
                {% if user_is_admin %}
                    {% trans %}Select a playlist and paste a link from YouTube, Soundcloud, Bandcamp, etc. Finally, press <kbd>Download</kbd>.{% endtrans %}
                    <form>
                        <select id="youtube-dl-directory" class="playlist-select"></select>
                        <input id="youtube-dl-url" type="text" placeholder="https://youtube.com/watch?v=..." size="45">
                        <input id="youtube-dl-submit" type="submit" value="{% trans %}Download{% endtrans %}">
                        <div id="youtube-dl-spinner" style="visibility: hidden" class="spinner"></div>
                        <br>
                        <div id="youtube-dl-output">{% trans %}yt-dlp output will appear here{% endtrans %}</div>
                    </form>
                {% else %}
                    <p>{% trans %}This feature is not enabled for your user account.{% endtrans %}</p>
                {% endif %}

                <h4>{% trans %}Credits{% endtrans %}</h4>
                <p>
                    {% trans trimmed gh="https://github.com/DanielKoomen/WebApp", robin_gh="https://github.com/Derkades", insp_gh="https://github.com/DanielKoomen/MusicPlayer", daniel_gh="https://github.com/DanielKoomen" %}
                    <a href="{{gh}}">Super fancy music player 2.0</a> is a project largely made by
                    <a href="{{robin_gh}}">Robin Slot</a>, inspired by the awesome
                    <a href="{{insp_gh}}" target="_blank">Super fancy music player</a> by
                    <a href="{{daniel_gh}}" target="_blank">Daniël Koomen</a>. Enjoy!
                    {% endtrans %}
                </p>
            </div>
        </div>
    </div>

    <div id="dialog-tags" class="full-page-overlay hidden dialog-overlay">
        <div class="box-rounded box-solid">
            {{ dialog_header('dialog-tags', gettext('Tags')) }}

            <div class="scroll">
                <select id="tag-mode">
                    <option value="allow">{% trans %}Only choose tracks with enabled tags (tracks without tags are never chosen){% endtrans %}</option>
                    <option value="deny" selected>{% trans %}Don't choose tracks with disabled tags (tracks with enabled tags or no tags are chosen){% endtrans %}</option>
                </select>{% trans %}Tag mode{% endtrans %}
                <div id="tag-checkboxes"></div>
            </div>
        </div>
    </div>

    <div id="dialog-browse" class="full-page-overlay hidden dialog-overlay">
        <div class="box-rounded box-solid">
            {{ dialog_header('dialog-browse', 'placeholder', back_id='browse-back') }}
            <div class="scroll">
                <select id="browse-filter-playlist" class="playlist-select">
                    <option value="all" data-keep="true">{% trans %}All{% endtrans %}</option>
                </select>

                <input id="browse-filter-query" type="text" placeholder="{% trans %}Search query{% endtrans %}">

                <div id="browse-content"></div>
            </div>
        </div>
    </div>

    <div id="dialog-editor" class="full-page-overlay hidden dialog-overlay">
        <div class="box-rounded box-solid">
            {{ dialog_header('dialog-editor', gettext('Metadata editor')) }}
            <div id="editor-content" class="scroll">
                <div>
                    <label for="editor-title">{% trans %}Title{% endtrans %}</label><br>
                    <input type="text" id="editor-title" value="" size="50">
                </div>
                <div>
                    <label for="editor-album">{% trans %}Album{% endtrans %}</label><br>
                    <input type="text" id="editor-album" value="" size="50">
                </div>
                <div>
                    <label for="editor-artists">{% trans %}Artists (delimit multiple using <kbd>;</kbd>){% endtrans %}</label><br>
                    <input type="text" id="editor-artists" value="" size="50">
                </div>
                <div>
                    <label for="editor-album-artist">{% trans %}Album artist{% endtrans %}</label><br>
                    <input type="text" id="editor-album-artist" value="" size="50">
                </div>
                <div>
                    <label for="editor-album-tags">{% trans %}Tags (delimit multiple using <kbd>;</kbd>){% endtrans %}</label><br>
                    <input type="text" id="editor-tags" value="" size="50">
                </div>

                {{ icon_button('content-save', 'editor-save') }}

                <p id="editor-writing" class="hidden">{% trans %}Writing metadata...{% endtrans %}</p>
                <p id="editor-reloading" class="hidden">{% trans %}Reloading tracks...{% endtrans %}</p>
            </div>
        </div>
    </div>

    <div id="loading-overlay" class="full-page-overlay">
        <div>
            <div class="flex-content-center">
                <div class="spinner spinner-large"></div>
            </div>
            <div>
                <h3 class="loading-text">{% trans %}Loading...{% endtrans %}</h3>
                <p class="secondary">
                    If this is taking longer than expected, please check the browser console.
                </p>
            </div>
        </div>
    </div>

    <canvas id="visualiser"></canvas>

    <div id="audio"></div>

    <div class="vignette"></div>

    {% assets "js/*.js", filters="jsmin", output="gen/packed.js" %}
        <script src="{{ ASSET_URL }}"></script>
    {% endassets %}

    <div class="hidden" id="csrf-token">{{ csrf_token }}</div>
    <div class="hidden" id="trans-artist">{% trans %}Artist: {% endtrans %}</div>
    <div class="hidden" id="trans-album">{% trans %}Album: {% endtrans %}</div>
    <div class="hidden" id="trans-tag">{% trans %}Tag: {% endtrans %}</div>
    <div class="hidden" id="trans-all-tracks">{% trans %}All tracks{% endtrans %}</div>
    <template id="template-queue-spinner">
        <tr>
            <td colspan="3" class="secondary downloading">
                <span class="spinner"></span>
            </td>
        </tr>
    </template>
    <template id="template-td-cover">
        <td class="box-rounded">
            <div class="delete-overlay">
                <div class="icon" style="background-image: url('/static/icon/delete.svg')"></div>
            </div>
        </td>
    </template>

{% endblock content %}
